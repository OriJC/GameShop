trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  imageNameBackend: 'gameshop-backend'
  imageNameFrontend: 'gameshop-frontend'

steps:
- script: curl -I https://api.nuget.org/v3/index.json
  displayName: "Test NuGet connectivity"
- script: |
    openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -keyout /etc/ssl/private/gameshop.key \
    -out /etc/ssl/certs/gameshop.pem \
    -subj "/CN=localhost"
  displayName: 'Generate SSL Certificates'   
- task: DockerCompose@0
  displayName: Build and push images
  inputs:
    containerregistrytype: 'Container Registry'
    dockerComposeFile: 'docker-compose.yml'
    action: 'Build services'
    additionalImageTags: '$(Build.BuildId)'
    projectName: 'gameshop'
 
